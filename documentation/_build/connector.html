<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tâche de déplacement du connecteur de la sonde &mdash; Robothon - Polytech Sorbonne 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="_static/css/isir.css?v=6ef2c474" />

  
    <link rel="shortcut icon" href="_static/icon-su.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=2709fde1"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/js/mermaid_isir.js?v=71f574c8"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tâche de la trappe &amp; sonde (Partie 1)" href="trappe.html" />
    <link rel="prev" title="Tâche du slider" href="slider.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Robothon - Polytech Sorbonne
              <img src="_static/logo-robothon.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Projet</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="presentation_projet.html">Présentation du projet</a></li>
<li class="toctree-l1"><a class="reference internal" href="rappel_cdc.html">Rappel du cahier des charges</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration matérielle</a></li>
<li class="toctree-l1"><a class="reference internal" href="ressources.html">Ressources réutilisées</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Environnement de développement</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture logiciel</a></li>
<li class="toctree-l1"><a class="reference internal" href="surcharge.html">Surcharge de la classe “<em>panda_robothon</em>”</a></li>
<li class="toctree-l1"><a class="reference internal" href="tf.html">Définition de TFs au niveau de l’effecteur final</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation système et démarrage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation_RT.html">Installation du noyau temps réel</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller_fci.html">Utilisation du controlleur du robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="demarrage.html">Commandes pour exécution des tâches</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Primitives des tâches</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="SIFT.html">Perception de la taskboard avec SIFT</a></li>
<li class="toctree-l1"><a class="reference internal" href="bouton-bleu.html">Tâche pour le bouton bleu</a></li>
<li class="toctree-l1"><a class="reference internal" href="slider.html">Tâche du slider</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tâche de déplacement du connecteur de la sonde</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#objectifs">Objectifs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#etapes-principales">Etapes principales</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#video-de-demonstration-de-la-tache">Vidéo de démonstration de la tâche</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="trappe.html">Tâche de la trappe &amp; sonde (Partie 1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="sonde.html">Tâche de la trappe &amp; sonde (Partie 2)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">A propos</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://www.polytech.sorbonne-universite.fr">Polytech Sorbonne</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.isir.upmc.fr/">ISIR</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/peterso/robothon-grand-challenge">Robothon Grand Challenge</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Robothon - Polytech Sorbonne</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tâche de déplacement du connecteur de la sonde</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/connector.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tache-de-deplacement-du-connecteur-de-la-sonde">
<h1>Tâche de déplacement du connecteur de la sonde<a class="headerlink" href="#tache-de-deplacement-du-connecteur-de-la-sonde" title="Link to this heading"></a></h1>
<style>
    .image{
    border: 5px solid #116aa4;
    border-radius: 10px;
    /* padding: 2px; */
    }
</style>
<section id="objectifs">
<h2>Objectifs<a class="headerlink" href="#objectifs" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Localiser la task-board avec SIFT (comme toutes les tâches à réaliser),</p></li>
<li><p>Atteindre la position initiale du connecteur de la sonde (<code class="docutils literal notranslate"><span class="pre">port</span> <span class="pre">noir</span></code>),</p></li>
<li><p>Pouvoir saisir le connecteur sans endommager le connecteur, ni la boîte, en soignant la trajectoire de montée</p></li>
<li><p>Localiser la position finale du port dans lequel le connecteur est destiné (<code class="docutils literal notranslate"><span class="pre">port</span> <span class="pre">rouge</span></code>),</p></li>
<li><p>Trouver la bonne trajectoire pour l’insertion (nécessité d’une grande précision ici pour éviter tout endommagement)</p></li>
<li><p>Insérer le connecteur assez profond pour que la tâche soit valide, et lâcher le connecteur de la sonde</p></li>
</ul>
</section>
<section id="etapes-principales">
<h2>Etapes principales<a class="headerlink" href="#etapes-principales" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Ouverture des pinces pour pouvoir saisir le connecteur de la sonde qui est par défaut placé au niveau du port noir,</p></li>
<li><p>Déplacement de l’effecteur finale vers la TF au niveau du port noir <code class="docutils literal notranslate"><span class="pre">task_board_starting_connector_hole_link</span></code>, avec une certaine hauteur,</p></li>
<li><p>Saisie du connecteur,</p></li>
<li><p>Deconnexion du connecteur du port noir (donc déplacement vers le haut du conecteur),</p></li>
<li><p>Déplacement de l’effecteur finale vers la TF au niveau du port rouge <code class="docutils literal notranslate"><span class="pre">task_board_ending_connector_hole_link</span></code>, avec une certaine hauteur,</p></li>
<li><p>Insertion du connecteur dans le port rouge en intégrant une trajectoire en spirale pour permettre d’être sûr d’insérer au bon endroit,</p></li>
<li><p>Retour de l’effecteur finale à une position “<code class="docutils literal notranslate"><span class="pre">home2</span></code>”.</p></li>
</ul>
<p>Vous pouvez voir ci-dessous le script python (”<code class="docutils literal notranslate"><span class="pre">connector_hole.py</span></code>”) permettant de planifier la trajectoire de l’effecteur finale, pour la saisie et le rebranchement du connecteur de la sonde :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>class<span class="w"> </span>Connector:
<span class="w">    </span>def<span class="w"> </span>__init__<span class="o">(</span>self<span class="o">)</span>:
<span class="w">        </span>rospy.init_node<span class="o">(</span><span class="s1">&#39;connector_hole&#39;</span>,<span class="w"> </span><span class="nv">anonymous</span><span class="o">=</span>True<span class="o">)</span>
<span class="w">        </span>self.rate<span class="w"> </span><span class="o">=</span><span class="w"> </span>rospy.Rate<span class="o">(</span><span class="m">100</span><span class="o">)</span>
<span class="w">        </span>self.panda<span class="w"> </span><span class="o">=</span><span class="w"> </span>Panda_R<span class="o">()</span>
<span class="w">        </span>self.panda.set_stiffness<span class="o">(</span><span class="m">4000</span>,<span class="w"> </span><span class="m">4000</span>,<span class="w"> </span><span class="m">4000</span>,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<span class="w">        </span>self._service<span class="w"> </span><span class="o">=</span><span class="w"> </span>rospy.Service<span class="o">(</span><span class="s1">&#39;connector_srv&#39;</span>,<span class="w"> </span>Trigger,<span class="w"> </span>self.run<span class="o">)</span>
<span class="w">    </span>
<span class="w">    </span>def<span class="w"> </span>run<span class="o">(</span>self,<span class="w"> </span>req<span class="o">)</span>:
<span class="w">        </span><span class="nv">final_resp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>TriggerResponse<span class="o">()</span>

<span class="w">        </span><span class="c1">####################################################################################</span>
<span class="w">        </span><span class="c1">############################## Tâche du connecteur #################################</span>

<span class="w">        </span><span class="c1"># Ouverture des pinces de l&#39;effecteur finale</span>
<span class="w">        </span>self.panda.move_gripper<span class="o">(</span><span class="m">0</span>.05<span class="o">)</span>
<span class="w">        </span>rospy.sleep<span class="o">(</span><span class="m">1</span>.0<span class="o">)</span>
<span class="w">        </span><span class="c1"># Get character from console</span>
<span class="w">        </span><span class="c1"># Déplacement de la TF `tool` (reliée à l&#39;EE) à la TF du port noir initiale</span>
<span class="w">        </span>self.panda.go_to_frame<span class="o">(</span><span class="s1">&#39;task_board_starting_connector_hole_link&#39;</span>,<span class="w"> </span><span class="s1">&#39;tool&#39;</span>,<span class="w"> </span>True,<span class="w"> </span><span class="m">0</span>.1<span class="o">)</span>
<span class="w">        </span><span class="c1"># Compensation du décalage des TF par rapport aux positions réelles</span>
<span class="w">        </span>self.panda.offset_compensator<span class="o">(</span><span class="m">10</span><span class="o">)</span>
<span class="w">        </span><span class="c1"># Modification de la hauteur une fois les TFs aligner</span>
<span class="w">        </span>self.panda.go_to_frame<span class="o">(</span><span class="s1">&#39;task_board_starting_connector_hole_link&#39;</span>,<span class="w"> </span><span class="s1">&#39;tool&#39;</span>,<span class="w"> </span>True,<span class="w"> </span><span class="m">0</span>.002<span class="o">)</span>

<span class="w">        </span><span class="c1"># Fermeture de l&#39;effecteur pour la saisie du connecteur</span>
<span class="w">        </span>self.panda.grasp_gripper<span class="o">(</span><span class="m">0</span>.0015<span class="o">)</span>
<span class="w">        </span>rospy.sleep<span class="o">(</span><span class="m">1</span>.0<span class="o">)</span>
<span class="w">        </span><span class="c1"># Changement de hauteur de la TF `tool` pour retirer le connecteur du port noir</span>
<span class="w">        </span>self.panda.go_to_frame<span class="o">(</span><span class="s1">&#39;task_board_starting_connector_hole_link&#39;</span>,<span class="w"> </span><span class="s1">&#39;tool&#39;</span>,<span class="w"> </span>True,<span class="w"> </span><span class="m">0</span>.1<span class="o">)</span>
<span class="w">        </span><span class="c1"># Compensation du décalage des TF par rapport aux positions réelles</span>
<span class="w">        </span>self.panda.offset_compensator<span class="o">(</span><span class="m">10</span><span class="o">)</span>
<span class="w">        </span><span class="c1"># Réglage des raideurs selon les axes en position et en orientation, de l&#39;effecteur finale</span>
<span class="w">        </span>self.panda.set_stiffness<span class="o">(</span><span class="m">2000</span>,<span class="w"> </span><span class="m">2000</span>,<span class="w"> </span><span class="m">2000</span>,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<span class="w">        </span><span class="c1"># Déplacement de la TF `tool` vers la TF du port rouge</span>
<span class="w">        </span>self.panda.go_to_frame<span class="o">(</span><span class="s1">&#39;task_board_ending_connector_hole_link&#39;</span>,<span class="w"> </span><span class="s1">&#39;tool&#39;</span>,<span class="w"> </span>True,<span class="w"> </span><span class="m">0</span>.1<span class="o">)</span>
<span class="w">        </span><span class="c1"># Compensation du décalage des TF par rapport aux positions réelles</span>
<span class="w">        </span>self.panda.offset_compensator<span class="o">(</span><span class="m">10</span><span class="o">)</span>
<span class="w">        </span><span class="c1"># Réglage des raideurs selon les axes en position et en orientation, de l&#39;effecteur finale</span>
<span class="w">        </span>self.panda.set_stiffness<span class="o">(</span><span class="m">100</span>,<span class="w"> </span><span class="m">100</span>,<span class="w"> </span><span class="m">1000</span>,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<span class="w">        </span><span class="c1"># self.panda.go_to_frame(&#39;task_board_ending_connector_hole_link&#39;, &#39;tool&#39;, True, 0.03)</span>
<span class="w">        </span><span class="c1"># Changement de hauteur de la TF `tool` pour placer le connecteur au dessus du port rouge</span>
<span class="w">        </span>self.panda.go_to_frame<span class="o">(</span><span class="s1">&#39;task_board_ending_connector_hole_link&#39;</span>,<span class="w"> </span><span class="s1">&#39;tool&#39;</span>,<span class="w"> </span>True,<span class="w"> </span><span class="m">0</span>.023<span class="o">)</span>

<span class="w">        </span><span class="nv">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.linspace<span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">5</span>*2*np.pi,<span class="w"> </span><span class="m">2000</span><span class="o">)</span>

<span class="w">        </span><span class="c1"># the radius of the circle</span>
<span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.linspace<span class="o">(</span><span class="m">0</span>.003,<span class="w"> </span><span class="m">0</span>.001,<span class="w"> </span><span class="m">2000</span><span class="o">)</span>

<span class="w">        </span><span class="c1"># compute x1 and x2</span>
<span class="w">        </span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>r*np.cos<span class="o">(</span>theta<span class="o">)</span><span class="w"> </span>+<span class="w"> </span>self.panda.curr_pos<span class="o">[</span><span class="m">0</span><span class="o">]</span>
<span class="w">        </span><span class="nv">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>r*np.sin<span class="o">(</span>theta<span class="o">)</span><span class="w"> </span>+<span class="w"> </span>self.panda.curr_pos<span class="o">[</span><span class="m">1</span><span class="o">]</span>
<span class="w">        </span><span class="nv">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.linspace<span class="o">(</span>self.panda.curr_pos<span class="o">[</span><span class="m">2</span><span class="o">]</span>,<span class="w"> </span>self.panda.curr_pos<span class="o">[</span><span class="m">2</span><span class="o">]</span>-0.025,<span class="w"> </span><span class="m">2000</span><span class="o">)</span>

<span class="w">        </span><span class="c1"># Génération d&#39;une trajectoire en spirale pour permettre d&#39;insérer le connecteur avec prudence au niveau du port</span>
<span class="w">        </span>self.panda.play_trajectory<span class="o">(</span>x,<span class="w"> </span>y,<span class="w"> </span>z<span class="o">)</span>
<span class="w">        </span><span class="c1"># Insertion du connecteur dans le port rouge</span>
<span class="w">        </span>self.panda.go_to_frame<span class="o">(</span><span class="s1">&#39;task_board_ending_connector_hole_link&#39;</span>,<span class="w"> </span><span class="s1">&#39;tool&#39;</span>,<span class="w"> </span>True,<span class="w"> </span><span class="m">0</span>.003<span class="o">)</span>

<span class="w">        </span><span class="c1"># Réglage des raideurs selon les axes en position et en orientation, de l&#39;effecteur finale</span>
<span class="w">        </span>self.panda.set_stiffness<span class="o">(</span><span class="m">2000</span>,<span class="w"> </span><span class="m">2000</span>,<span class="w"> </span><span class="m">2000</span>,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<span class="w">        </span><span class="c1"># Ouverture des grippeurs pour relâcher le connecteur</span>
<span class="w">        </span>self.panda.move_gripper<span class="o">(</span><span class="m">0</span>.05<span class="o">)</span>
<span class="w">        </span>rospy.sleep<span class="o">(</span><span class="m">1</span>.0<span class="o">)</span>
<span class="w">        </span><span class="c1"># Mise en position de repos du robot</span>
<span class="w">        </span>self.panda.home<span class="o">(</span><span class="m">0</span>.25<span class="o">)</span>

<span class="w">        </span><span class="c1">#####################################################################################</span>
<span class="w">        </span><span class="c1">#####################################################################################</span>

<span class="w">        </span>final_resp.message<span class="w"> </span><span class="o">=</span><span class="w"> </span>f<span class="s2">&quot;End connector&quot;</span>
<span class="w">        </span>final_resp.success<span class="w"> </span><span class="o">=</span><span class="w"> </span>True
<span class="w">        </span><span class="k">return</span><span class="w"> </span>final_resp
</pre></div>
</div>
<section id="video-de-demonstration-de-la-tache">
<h3>Vidéo de démonstration de la tâche<a class="headerlink" href="#video-de-demonstration-de-la-tache" title="Link to this heading"></a></h3>
<p>On vous met ci-dessous la vidéo de simulation de l’exécution de la tâche du déplacement du connecteur de la sonde du port, sur RVIZ et avec le robot réel, noir au port rouge :</p>
<table align="center" cellspacing="20" cellpadding="5">
    <tr>
        <th>
            <div class="image">
            <iframe width="700" height="600" src="https://drive.google.com/file/d/1zPRZtJ2xx7lAX1rjNHTEf67RcRY1jYd4/preview" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
            </div>
        </th>
        <th>
            <div class="image">
            <iframe width="700" height="600" src="https://drive.google.com/file/d/1EBnWxSV949HCzNa1_ls4fdOVQBamQciP/preview" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
            </div>
        </th>
    </tr>
</table>
<figure class="align-center" id="id1">
<div class="mermaid">
            graph LR
        </div><figcaption>
<p><span class="caption-number">Fig. 59 </span><span class="caption-text">Simulation de la tâche du connecteur de la sonde avec les positions initiales home et home2 sur RVIZ, et en réel</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="slider.html" class="btn btn-neutral float-left" title="Tâche du slider" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="trappe.html" class="btn btn-neutral float-right" title="Tâche de la trappe &amp; sonde (Partie 1)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
<jinja2.runtime.BlockReference object at 0x7f692399d510>
<!-- your custom footer here-->
<!-- source : https://stackoverflow.com/questions/66919550/trouble-with-custom-footer-in-sphinx-rtd-theme -->
<div>
    <table align="center" style="width: 100%">
        <tr>
            <th>
                <img src="./_static/logos/logo-polytech.png"/>
            </th>
            <th>
                <img src="./_static/logos/logo-su.png"/>
            </th>
            <th>
                <img src="./_static/logos/logo-isir.png"/>
            </th>
            <th>
                <img src="./_static/logos/logo-robothon.png"/>
            </th>
        </tr>
    </table>
</div>

  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>